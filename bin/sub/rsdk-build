#!/usr/bin/env bash

SCRIPT_DIR="$(dirname "$(realpath "$0")")"
# shellcheck source=bin/lib/utils.sh
source "$SCRIPT_DIR/../lib/utils.sh"

PRODUCT="${1}"
SUITE="${2:-bullseye}"
EDITION="${3:-cli}"
OUTPUT="$PWD/out/${PRODUCT}_${SUITE}_${EDITION}"

if [[ -f "$OUTPUT/rootfs.tar" ]] && (($(du -b "$OUTPUT/rootfs.tar" | cut -f 1) == 0)); then
	sudo rm "$OUTPUT/rootfs.tar"
fi

if [[ ! -f "$OUTPUT/rootfs.tar" ]]; then
	rsdk build-rootfs "$PRODUCT" "$SUITE" "$EDITION"
fi

rsdk build-image "$PRODUCT" "$SUITE" "$EDITION"
